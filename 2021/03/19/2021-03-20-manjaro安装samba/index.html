<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="这是始于兴趣搭建的个人博客。"><meta name="baidu-site-verification"><title>manjaro安装samba | CAIJINBO</title><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.png"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="CAIJINBO" type="application/atom+xml">
</head><link rel="stylesheet" type="text/css" href="/plugins/prettify/doxy.css"><script type="text/javascript" src="/js/ready.js" async></script><body class="night"><div class="mobile-head" id="mobile-head"><div class="navbar-icon"><span></span><span></span><span></span></div><div class="navbar-title"><a href="/">CAIJINBO</a></div><div class="navbar-search"><!--= show a circle here--></div></div><div class="h-wrapper" id="menu"><nav class="h-head box"><div class="m-hdimg"><a class="hdimg img" href="/"><img class="nofancybox" src="/img/profile.jpg" width="128" height="128"></a><h1 class="ttl"><a href="/">CAIJINBO</a></h1></div><p class="m-desc">懒人在思考......,<br>解决不了问题，就解决提出问题的人！</p><div class="m-nav"><ul><li><span class="dot">●</span><a href="/archives/">归档</a></li><li><span class="dot">●</span><a href="/categories/">分类</a></li><li><span class="dot">●</span><a href="/tags/">标签</a></li><li><span class="dot">●</span><a href="/about/">关于</a></li><li><span class="dot">●</span><a href="/atom.xml">RSS</a></li><li class="m-sch"><form class="form" id="j-formsch" method="get"><input class="txt" type="text" id="local-search-input" name="q" value="搜索" onfocus="if(this.value=='搜索'){this.value='';}" onblur="if(this.value==''){this.value='搜索';}"><input type="text" style="display:none;"></form></li></ul><div id="local-search-result"></div></div></nav></div><div id="back2Top"><a class="fa fa-arrow-up" title="Back to top" href="#"></a></div><div class="box" id="container"><div class="l-wrapper"><div class="l-content box"><div class="l-post l-post-art"><article class="p-art"><div class="p-header box"><h1 class="p-title">manjaro安装samba</h1><div class="p-info"><span class="p-date"><i class="fa fa-calendar"></i><a href="/2021/03/19/2021-03-20-manjaro%E5%AE%89%E8%A3%85samba/">2021-03-19</a></span><span class="p-category"><i class="fa fa-folder"></i><a href="/categories/linux/">linux</a></span><span class="p-view" id="busuanzi_container_page_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_page_pv"></span></span></div></div><div class="p-content"><h4 id="1-安装软件"><a href="#1-安装软件" class="headerlink" title="1.安装软件"></a>1.安装软件</h4><blockquote>
<p>sudo pacman -S samba nautilus-share manjaro-settings-samba</p>
</blockquote>
<a id="more"></a>

<h4 id="2-备份一下smb-conf文件"><a href="#2-备份一下smb-conf文件" class="headerlink" title="2.备份一下smb.conf文件"></a>2.备份一下smb.conf文件</h4><blockquote>
<p>cp /etc/samba/smb.conf  /etc/samba/smb.conf.bak</p>
</blockquote>
<h4 id="3-修改smb-conf文件"><a href="#3-修改smb-conf文件" class="headerlink" title="3.修改smb.conf文件"></a>3.修改smb.conf文件</h4><blockquote>
<p>sudo vim /etc/samba/smb.conf</p>
</blockquote>
<blockquote>
<p>[global]<br>   workgroup = WORKGROUP<br>   dns proxy = no<br>   log file = /var/log/samba/%m.log<br>   max log size = 1000<br>   client min protocol = SMB2<br>   server role = standalone server<br>   passdb backend = tdbsam<br>   obey pam restrictions = yes<br>   unix password sync = yes<br>   passwd program = /usr/bin/passwd %u<br>   passwd chat = <em>New<em>UNIX</em>password</em> %n\n <em>ReType<em>new</em>UNIX*password</em> %n\n <em>passwd:<em>all</em>authentication<em>tokens</em>updated*successfully</em><br>   pam password change = yes<br>   map to guest = Bad Password<br>   usershare allow guests = yes<br>   name resolve order = lmhosts bcast host wins<br>   security = user<br>   guest account = nobody<br>   usershare path = /var/lib/samba/usershare<br>   usershare max shares = 100<br>   usershare owner only = yes<br>   force create mode = 0070<br>   force directory mode = 0070</p>
<p>[homes]           —-&gt;  这一段要注释掉，否则会暴露家目录<br>   comment = Home Directories<br>   browseable = no<br>   read only = yes<br>   create mask = 0700<br>   directory mask = 0700<br>   valid users = %S</p>
<p>[printers]<br>   comment = All Printers<br>   browseable = no<br>   path = /var/spool/samba<br>   printable = yes<br>   guest ok = no<br>   read only = yes<br>   create mask = 0700</p>
<p>[print$]<br>   comment = Printer Drivers<br>   path = /var/lib/samba/printers<br>   browseable = yes<br>   read only = yes<br>   guest ok = no</p>
<p>[share]                                                                      # 分享目录，可自定义名字<br>path = /home/unknown/samba_share               # 分享实际目录<br>browseable = yes                                                    # 共享的目录是否让所有人可见<br>read only = no                                                         # 是否只读<br>create mask = 0700                                                # 客户端上传文件的默认权限<br>directory mask = 0700                                           # 客户端创建目录的默认权限<br>writable = yes                                                          # 是否可写<br>guest ok = yes                                                          #是否允许匿名(guest)访问,等同于public</p>
</blockquote>
<h4 id="将系统用户添加到samba用户，并设置密码"><a href="#将系统用户添加到samba用户，并设置密码" class="headerlink" title="将系统用户添加到samba用户，并设置密码"></a>将系统用户添加到samba用户，并设置密码</h4><blockquote>
<p>sudo smbpasswd -a unknown</p>
</blockquote>
<h4 id="查看所有的samba用户"><a href="#查看所有的samba用户" class="headerlink" title="查看所有的samba用户"></a>查看所有的samba用户</h4><blockquote>
<p>sudo pdbedit -L</p>
</blockquote>
<h4 id="查看对应ip上的samba服务器，例如查看本机samba"><a href="#查看对应ip上的samba服务器，例如查看本机samba" class="headerlink" title="查看对应ip上的samba服务器，例如查看本机samba"></a>查看对应ip上的samba服务器，例如查看本机samba</h4><blockquote>
<p>sudo smbclient -L 127.0.0.1</p>
</blockquote>
<h4 id="创建共享目录"><a href="#创建共享目录" class="headerlink" title="创建共享目录"></a>创建共享目录</h4><blockquote>
<p>mkdir /home/unknown/samba_share<br>chmod 777 -R /home/unknown/samba_share</p>
</blockquote>
<h4 id="重启smb，nmb服务"><a href="#重启smb，nmb服务" class="headerlink" title="重启smb，nmb服务"></a>重启smb，nmb服务</h4><blockquote>
<p>sudo systemctl restart smb nmb</p>
</blockquote>
<h4 id="如果重启失败，则执行testparm检查sam-conf是否有语法错误"><a href="#如果重启失败，则执行testparm检查sam-conf是否有语法错误" class="headerlink" title="如果重启失败，则执行testparm检查sam.conf是否有语法错误"></a>如果重启失败，则执行testparm检查sam.conf是否有语法错误</h4><blockquote>
<p>testparm</p>
</blockquote>
<h4 id="验证samba是否可以访问"><a href="#验证samba是否可以访问" class="headerlink" title="验证samba是否可以访问"></a>验证samba是否可以访问</h4><blockquote>
<p>smbclient //192.168.0.10/share</p>
</blockquote>
<h4 id="Windows系统上验证"><a href="#Windows系统上验证" class="headerlink" title="Windows系统上验证"></a>Windows系统上验证</h4><blockquote>
<p>\192.168.0.10</p>
</blockquote>
<h4 id="将共享目录挂载到本地（未验证）"><a href="#将共享目录挂载到本地（未验证）" class="headerlink" title="将共享目录挂载到本地（未验证）"></a>将共享目录挂载到本地（未验证）</h4><blockquote>
<p>mount -t cifs -o username=xxx //192.168.0.10/share /mnt/tmp</p>
</blockquote>
<h4 id="其他知识补充：-网上抄录，未验证"><a href="#其他知识补充：-网上抄录，未验证" class="headerlink" title="其他知识补充：(网上抄录，未验证)"></a>其他知识补充：(网上抄录，未验证)</h4><p>目前samba有三种后台：smbpasswd、tdbsam和ldapsam。sam应该是security account manager（安全账户管理）的简写。<br>1.smbpasswd：该方式是使用smb自己的工具smbpasswd来给系统用户（真实<br>用户或者虚拟用户）设置一个Samba密码，客户端就用这个密码来访问Samba的资源。smbpasswd文件默认在/etc/samba目录下，不过有时候要手工建立该文件。</p>
<p>2.tdbsam：该方式则是使用一个数据库文件来建立用户数据库。数据库文件叫passdb.tdb，默认在/etc/samba目录下。passdb.tdb用户数据库可以使用smbpasswd –a来建立Samba用户，不过要建立的Samba用户必须先是系统用户。我们也可以使用pdbedit命令来建立Samba账户。pdbedit命令的参数很多，我们列出几个主要的。<br>pdbedit –a username：新建Samba账户。<br>pdbedit –x username：删除Samba账户。<br>pdbedit –L：列出Samba用户列表，读取passdb.tdb数据库文件。<br>pdbedit –Lv：列出Samba用户列表的详细信息。<br>pdbedit –c “[D]” –u username：暂停该Samba用户的账号。<br>pdbedit –c “[]” –u username：恢复该Samba用户的账号。</p>
<p>3.ldapsam：该方式则是基于LDAP的账户管理方式来验证用户。首先要建立LDAP服务，然后设置“passdb backend = ldapsam:ldap://LDAP Server”客户端就用这个密码来访问Samba的资源。smbpasswd文件默认在/etc/samba目录下，不过有时候要手工建立该文件。</p>
</div><div class="p-copyright"><blockquote><div class="p-copyright-author"><span class="p-copyright-key">本文作者：</span><span class="p-copytight-value"><a href="mailto:litreily@163.com">caijinbo</a></span></div><div class="p-copyright-link"><span class="p-copyright-key">本文链接：</span><span class="p-copytight-value"><a href="/2021/03/19/2021-03-20-manjaro%E5%AE%89%E8%A3%85samba/">https://caijinbo.work/2021/03/19/2021-03-20-manjaro安装samba/</a></span></div><div class="p-copyright-note"><span class="p-copyright-key">版权声明：</span><span class="p-copytight-value">本博客所有文章除特殊声明外，均采用<a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/"> CC BY-NC 4.0 </a>许可协议。转载请注明出处 <a href="https://caijinbo.work">caijinbo的博客</a>！</span></div></blockquote></div></article><div class="p-info box"><span class="p-tags"><i class="fa fa-tag"></i><a href="/tags/linux/">linux</a></span></div><aside id="toc"><div class="toc-title">目录</div><nav><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-安装软件"><span class="toc-number">1.</span> <span class="toc-text">1.安装软件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-备份一下smb-conf文件"><span class="toc-number">2.</span> <span class="toc-text">2.备份一下smb.conf文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-修改smb-conf文件"><span class="toc-number">3.</span> <span class="toc-text">3.修改smb.conf文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#将系统用户添加到samba用户，并设置密码"><span class="toc-number">4.</span> <span class="toc-text">将系统用户添加到samba用户，并设置密码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看所有的samba用户"><span class="toc-number">5.</span> <span class="toc-text">查看所有的samba用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看对应ip上的samba服务器，例如查看本机samba"><span class="toc-number">6.</span> <span class="toc-text">查看对应ip上的samba服务器，例如查看本机samba</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建共享目录"><span class="toc-number">7.</span> <span class="toc-text">创建共享目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#重启smb，nmb服务"><span class="toc-number">8.</span> <span class="toc-text">重启smb，nmb服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#如果重启失败，则执行testparm检查sam-conf是否有语法错误"><span class="toc-number">9.</span> <span class="toc-text">如果重启失败，则执行testparm检查sam.conf是否有语法错误</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#验证samba是否可以访问"><span class="toc-number">10.</span> <span class="toc-text">验证samba是否可以访问</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Windows系统上验证"><span class="toc-number">11.</span> <span class="toc-text">Windows系统上验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#将共享目录挂载到本地（未验证）"><span class="toc-number">12.</span> <span class="toc-text">将共享目录挂载到本地（未验证）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#其他知识补充：-网上抄录，未验证"><span class="toc-number">13.</span> <span class="toc-text">其他知识补充：(网上抄录，未验证)</span></a></li></ol></nav></aside></div><section class="p-ext"><div class="l-pager l-pager-dtl box"><a class="prev" href="/2021/03/26/2021-03-27-mariadb%E9%85%8D%E7%BD%AE%E5%AF%86%E7%A0%81/">&lt; mariadb配置密码</a><a class="next" href="/2021/02/02/2021-02-03-Linux%E5%92%8CESXI%E9%85%8D%E7%BD%AEipmi/">Linux和ESXI配置ipmi &gt;</a></div></section><footer><p>Copyright © 2016 - 2021 <a href="/." rel="nofollow">CAIJINBO</a> | <strong><a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></strong><br><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span></span> <span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span></span> | Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a>Theme with<a rel="nofollow" target="_blank" href="https://github.com/litreily/snark-hexo"> snark.</a></p></footer></div></div></div><script type="text/javascript" src="/plugins/prettify/prettify.js"></script><script type="text/javascript" src="/js/search.js"></script><script type="text/javascript" src="/js/top.js"></script><script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
    search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"></body></html>